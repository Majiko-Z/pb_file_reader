
# 金融PB文件单接入, 扫单文件读取底层优化

## 优化动机/背景

1. 现有情况, 每个文件开启一个线程读取(线程总数太多问题)
2. 线程读取时，loop + sleep循环读取, 尝试反序列化(CPU占用过高问题)
3. 同一PB不同账户, 对应同一扫单文件, 也会开启多个线程读取(线程数太多+CPU占用高)

## features

1. 通过事件驱动而非循环等待
2. 同一文件只有一个线程扫单读, 根据反序列化信息发给不同业务线程

## 逻辑层级
1. level 1

使用一个线程L监听所有注册的扫单文件变化(`[windows IOCP]`/`[linux inotify/epoll]`/`[common notify]`)

使用一个线程T定时通知扫单线程读文件

2. level 2

文件读取线程R,阻塞,直到收取到线程L/T的通知, 并附带重试机制

3. level 3 (业务实现)

业务循环线程, select等待线程R的数据并处理

## 说明

1. 线程数T与监听文件数F相关 `T = F + 2`
2. 提供给业务mpsc::bounded接口,以便业务曾可以select同时处理多个文件


## usage

`TODO!()`



